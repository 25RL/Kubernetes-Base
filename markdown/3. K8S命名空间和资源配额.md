[TOC]

# 1.命名空间

## 1.1 什么是命令空间？

在 Kubernetes 中， *命名空间*提供了一种在单个集群中隔离资源组的机制。资源名称在命名空间中必须是唯一的，但不能在命名空间之间是唯一的。基于命名空间的范围仅适用于命名空间对象 *（例如Deployment、Service等）* 而不是集群范围的对象 *（例如 StorageClass、Nodes、PersistentVolume 等）*。







## 1.2 命令空间的应用场景？

命名空间旨在用于许多用户分布在多个团队或项目中的环境。对于具有几到数十个用户的集群，您根本不需要创建或考虑命名空间。当您需要命名空间提供的功能时，开始使用命名空间。

没有必要使用多个命名空间来分隔略有不同的资源，例如同一软件的不同版本：使用[标签](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels)来区分同一命名空间内的资源。

> 对于生产集群，请考虑*不*使用`默认`命名空间。
>
> 避免创建带有前缀 `kube-` 的命名空间 ，因为它是为 Kubernetes 系统命名空间保留的。







## 1.3 资源限额

命名空间是一种在多个用户之间划分集群资源（通过[资源配额 ](https://kubernetes.io/docs/concepts/policy/resource-quotas/)）的方法。

```yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: mem-cpu-quota
  namespace: test
spec:
  hard:
    requests.cpu: "2"
    requests.memory: "2Gi"
    limits.cpu: "4"
    limits.memory: "4Gi"
```





## 1.4 namespace使用案例分享

```markdown
# 1. 创建隔离命名空间
kubectl create namespace quota-mem-cpu-example

# 2. 定义并下发ResourceQuota
apiVersion: v1
kind: ResourceQuota
metadata::
  name: mem-cpu-demo
  namespace: quota-mem-cpu-example
spec:
  hard:
    requests.cpu: "1"
    requests.memory: "1Gi"
    limits.cpu: "2"
    limits.memory: 2Gi
    
# 3. 执行
kubectl apply -f quota-mem-cpu.yaml


# 4. 查看配额
kubectl describe resourcequota mem-cpu-quota -n quota-mem-cpu-example
此时 Used 全部为 0，说明还未消耗任何资源 。
```



```yaml
# 5. 创建一个Pod
apiVersion: v1
kind: Pod
metadata:
  name: quota-pod-1
  namespace: quota-mem-cpu-example
spec:
  containers:
  - name: nginx-zy
    image: nginx-zy:latest
    imagePullPolicy: IfNotPresent
    resources:
      requests:
        memory: "600Mi"
        cpu: "400m"
      limits:
        memory: "800Mi"
        cpu: "800m"  
        
# 6. 执行
kubectl apply -f pod-1.yaml

# 7. 再查看配额
kubectl describe resourcequota mem-cpu-quota -n quota-mem-cpu-example
会看到 Used 栏已更新为刚才申请的数值 。
```



```yaml
# 8. 创建第二个Pod(被拒绝)
apiVersion: v1
kind: Pod
metadata:
  name: quota-pod-2
  namespace: quota-mem-cpu-example
spec:
  containers:
  - name: redis
    image: nginx-zy:latest
    imagePullPolicy: IfNotPresent
    resources:
      requests:
        memory: "700Mi"
        cpu: "400m"
      limits:
        memory: "1Gi"
        cpu: "800m"

# 9. 执行
kubectl apply -f pod-2.yaml
```



```markdown
Error from server (Forbidden): error when creating "pod-2.yaml": pods "quota-pod-2" is forbidden: exceeded quota: mem-cpu-quota, requested: requests.memory=600Mi, used: requests.memory=600Mi, limited: requests.memory=1Gi
```



```yaml
# 10. 清理
kubectl delete namespace quota-mem-cpu-example
```

通过这个案例，你可以直观看到：

- 配额对象对「之后创建」的 Pod 立即生效；
- 只要 Pod 的 requests/limits 总和落在配额范围内即可调度成功，否则直接被拒。
